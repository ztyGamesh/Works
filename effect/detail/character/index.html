<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0,maximum-scale=1.0, user-scalable=no"/>
    <title>图文类详情页效果模板</title>
    <!--本地开发-->
    <!-- <link type="text/css" rel="stylesheet" href="character-v002.css"> -->
    <!--线上发布-->
    <link type="text/css" rel="stylesheet" href="http://effect.deepleaper.com/effect/css/character-v002.css">
</head>
<body>
<header>
    <h1>苹果发布会前瞻，iPhone 8 并不是最值得期待的新品</h1>
    <p class="author">小岗村村长</p>
</header>
<div class="content">
    <p class="articleCharacter">一年一度的苹果秋季新品发布会就要来了。北京时间 9 月 13 日凌晨 1 点，苹果将在其新总部 Apple Park 的「乔布斯剧场」举办新品发布会，届时 iPhone 7
        的后续机型、十周年版的 iPhone、增加 LTE 功能的 Apple Watch 等新品将会和大家见面。</p>
    <img class="articlePicture" src="" data-url="http://image-demo.oss-cn-hangzhou.aliyuncs.com/example.jpg">
    <p class="articleCharacter">最近几年，发布会前的各种爆料信息已经成为了苹果新品亮相的重要组成部分，但这次 iOS 11 GM
        固件的提前泄露几乎可以说是提前帮苹果召开了发布会。极客公园依据目前公开的信息，整理了一份苹果发布会前瞻指南，相信你在看完之后就算明天凌晨没有熬夜，也不会错失太多的内容。</p>
    <div class="articleCommodity"
         data-load="https://www.baidu.com" data-itemId="536567510031" data-uid="11111">
        <img class="articleCommodityPicture" src="imgIgnore/comodityPicTest1.jpg">
        <div class="articleCommodityWrapper">
            <p class="articleCommodityTitle">iphone7手机壳6s苹果6硅胶透明plus简约8超薄渐变防摔X保护套男女</p>
            <div class="articleCommodityPrice"><span class="symbol">&yen;</span><span class="price">9.9</span></div>
            <img class="buyBtn" src="http://effect.deepleaper.com/effect/img/buyBtn.png">
        </div>
    </div>
    <img class="articlePicture" src="" data-url="http://image-demo.oss-cn-hangzhou.aliyuncs.com/example.jpg">
    <div class="articleCommodity"
         data-load="https://www.baidu.com" data-itemId="536567510031" data-uid="22222">
        <img class="articleCommodityPicture" src="imgIgnore/comodityPicTest1.jpg">
        <div class="articleCommodityWrapper">
            <p class="articleCommodityTitle">iphone7手机壳6s苹果6硅胶透明plus简约8超薄渐变防摔X保护套男女</p>
            <div class="articleCommodityPrice"><span class="symbol">&yen;</span><span class="price">9.9</span></div>
            <img class="buyBtn" src="http://effect.deepleaper.com/effect/img/buyBtn.png">
        </div>
    </div>
    <p class="articleCharacter">毫无疑问，对于苹果每年的秋季发布会，iPhone 总是最受关注的系列产品，当然，苹果同样在它身上花费的精力也是最多。</p>
</div>
<footer>
    原创文章，作者：小岗村村长。转载或内容合作请联系test@deepleaper.com；违规转载法律必究。寻求报道请加微信：abx 文本图片来自：视觉中国 正版图库
</footer>


<!--推荐列表样式模板 开始-->
<div class="recommendList">
    <img class="recommend" src="http://effect.deepleaper.com/effect/img/recommend.png">
    <ul>
        <!--li class="styleOne" 为单图样式  3:2-->
        <li class="styleOne">
            <a href="http://www.baidu.com">
                <div class="styleOneWrapper">
                    <img class="listPic" src="imgIgnore/300-200.jpg">
                    <div class="contentWrapper">
                        <p class="contentTitle">iOS 11 GM的提前泄露几乎可以说是提前帮苹果召开了发布会</p>
                    </div>
                    <span class="contentSource">一起玩</span>
                </div>
                <div class="decorate color_1"></div>
            </a>
        </li>
        <!--li class="styleTwo" 为三图样式   3:2-->
        <li class="styleTwo">
            <a href="http://www.baidu.com">
                <p class="contentTitle">紧随其后，9月12日一年一度的苹果发布会，将闪耀降临。两者上市事件如此巧合</p>
                <img class="listPic" src="imgIgnore/300-200.jpg">
                <img class="listPic" src="imgIgnore/300-200.jpg">
                <img class="listPic" src="imgIgnore/300-200.jpg">
                <p class="contentSource">一起玩</p>
                <div class="decorate color_2"></div>
            </a>
        </li>
        <!--li class="styleThree" 为大图样式  16:9-->
        <li class="styleThree">
            <a href="http://www.baidu.com">
                <div class="styleOneWrapper">
                    <img class="listPic" src="imgIgnore/16_9.jpg">
                    <div class="contentWrapper">
                        <p class="contentTitle">iOS 11 GM的提前泄露几乎可以说是提前帮苹果召开了发布会</p>
                    </div>
                    <span class="contentSource">一起玩</span>
                </div>
                <div class="decorate color_1"></div>
            </a>
        </li>
    </ul>
</div>
<!--推荐列表样式模板 结束-->


<!--渲染详情页的JS 渲染详情页的JS 渲染详情页的JS 渲染详情页的JS 渲染详情页的JS 渲染详情页的JS 渲染详情页的JS 开始-->

<!--引入阿里百川API 提供deeplink功能 开始-->
<script type="text/javascript" src="//g.alicdn.com/mtb/lib-applink/0.3.6/??callApp.js,linksdk.js"></script>
<!--引入阿里百川API 提供deeplink功能 结束-->

<!--页面功能JS 开始-->
<script type="text/javascript">
    window.onload = function () {

        //根据屏幕分辨率请求相应尺寸的图片，目的是减少带宽传输
        var screenWidth = window.screen.width.toFixed(0);
        var articlePictures = document.getElementsByClassName('articlePicture');
        if (articlePictures.length !== 0) {
            for (var i = 0; i < articlePictures.length; i++) {
                var articlePictureUrl = articlePictures[i].getAttribute('data-url') + '?x-oss-process=image/resize,w_' + screenWidth;
                articlePictures[i].setAttribute('src', articlePictureUrl);
            }
        }

        //监测：详情页停留时长 每10秒请求一次
        //readDurationUrl:占位符 监测链接
        //单位：毫秒
        var readDurationUrl = '';
        var startDate = new Date();
        setInterval(function () {
            var endDate = new Date();
            var readDuration = endDate.getTime() - startDate.getTime();
            var readDurationEle = document.createElement('img');
            readDurationEle.setAttribute('src', readDurationUrl + '?time=' + readDuration);
        }, 10000);

        //监测：文章阅读完成率 0.25  0.5  0.75  1
        //readScaleUrl:占位符 监测链接
        var readScaleUrl = '';
        var screenHeight = window.screen.height;
        var footer = document.getElementsByTagName('footer')[0];
        var footerInitTop = footer.offsetTop;
        var hasSend_25 = false;
        var hasSend_50 = false;
        var hasSend_75 = false;
        var hasSend_100 = false;
        //如果文章小于一屏 发送阅读完成
        if (footerInitTop <= screenHeight) {
            var readScaleEle = document.createElement('img');
            readScaleEle.setAttribute('src', readScaleUrl + '?scale=' + 1);
        } else {
            window.onscroll = function () {
                var scale = (document.documentElement.scrollTop + screenHeight) / footerInitTop;
                var readScaleEle = document.createElement('img');
                if (0.25 < scale < 0.5) {
                    if (!hasSend_25) {
                        readScaleEle.setAttribute('src', readScaleUrl + '?scale=' + 0.25);
                        hasSend_25 = true;
                    }
                } else if (0.5 < scale < 0.75) {
                    if (!hasSend_50) {
                        readScaleEle.setAttribute('src', readScaleUrl + '?scale=' + 0.5);
                        hasSend_50 = true;
                    }

                } else if (0.75 < scale < 1) {
                    if (!hasSend_75) {
                        readScaleEle.setAttribute('src', readScaleUrl + '?scale=' + 0.75);
                        hasSend_75 = true;
                    }

                } else if (scale > 1) {
                    if (!hasSend_100) {
                        readScaleEle.setAttribute('src', readScaleUrl + '?scale=' + 1);
                        hasSend_100 = true;
                    }
                }
            }
        }

        //初始化阿里百川API
        window.BC_SDK = BCSDK_AppLink.init({
            appkey: '23082328', //必填，输入百川应用的appkey
            backURL: '', //必填，默认为空字符串，applink的tips的回跳url， 设置能在手机淘宝里面调回你自己应用的url，格式为`tbopen${appkey}`。
            openApp: false, //非必填，默认为true，非必填，是否唤起客户端，设置false，只会做H5跳转。
            linkKey: 'TB', //非必填，默认为TB, 唤起手淘(TB)/天猫(TM)。
            isNeedDownload: false, //非必填，默认为false, 没有app的情况下跳转目标h5页面还是下载页, 默认跳转目标h5页面。
            isDefaultRedirect: true, //选填, 没有唤起app的情况下是否默认跳转, 默认true。
            params: {}, //非必填，带给applink协议的扩展参数,用户自定义参数也传在这里, 如scm、pvid、pid、subpid、e、unionId等业务参数会放到这里。
            trackParams: {}, //非必填，ybhpss的映射对象，传入这里的参数会被拼为ybhpss字符串带到协议上。  
            timeout: 5000 // 非必填，默认跳转(目标h5页/下载页)的延时时长。
        });

        //goodsInfo  占位符，数组类型，元素文章商品信息（顺序对应）
        //key:uid   商品uid
        //value:uid-monitorUrl 商品点击监测链接
        //value:uid-tkUrl 淘客Url
        //value:uid-pid 淘客关键参数pid
        var goodsInfo = {
            '11111': {
                'monitorUrl': './imgIgnore/1.png',
                'tkUrl': '//s.click.taobao.com/ItYlcXx',
                'pid': 'xxx'
            }
        };

        //检索商品，为每个商品添加点击事件
        var articleCommoditys = document.getElementsByClassName('articleCommodity');
        if (articleCommoditys.length !== 0) {
            for (var i = 0; i < articleCommoditys.length; i++) {
                articleCommoditys[i].addEventListener('click', function () {
                    try {
                        var uid = this.getAttribute('data-uid');
                        //商品点击监测
                        var img = document.createElement('img');
                        img.onload = img.onerror = function () {
                            //使用阿里百川API调起手机淘宝APP
                            window.BC_SDK.goTaoke({
                                tkUrl: goodsInfo[uid].tkUrl,
                                params: {
                                    pid: goodsInfo[uid].pid, // 淘客必填
                                    subpid: "xxx",
                                    unionId: "xxx"
                                }
                            });
                        };
                        img.setAttribute('src', goodsInfo[uid].monitorUrl);
                    } catch (e) {
                        console.log('商品点击异常:' + e)
                    }
                });
            }
        }
    };
</script>
<!--页面功能JS 结束-->

<!--请求推荐列表 开始-->
<script type="text/javascript">
    //请求推荐列表 开始
    function getQueryString(name) {
        var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)");
        var r = window.location.search.substr(1).match(reg);
        return r != null ? unescape(r[2]) : null;
    }

    function getArticleUid() {
        var r = window.location.pathname.split('/');
        if (r.length == 0) {
            return null;
        }
        return r[r.length - 1];
    }

    function insertRecContent(data) {
        var recNode = document.getElementById('recommendList');
        if (recNode != null) {
            recNode.innerHTML = data;
        }
    }

    function xhrHandle(result, callback) {
        var req = JSON.parse(result);
        if (req.code == 0) {
            insertRecContent(req.data);
        }
    }

    var token = getQueryString('token');
    var uid = getArticleUid();
    if (token != null && uid != null) {
        var params = {
            "request_type": "detail_page",
            "rec_params": {
                "article_uid": uid,
                "params_token": token
            }
        };

        var request = new XMLHttpRequest();
        request.open('post', '[:REC_REQUEST_URL:]', true);
        request.withCredentials = true;
        request.onreadystatechange = function () {
            if (request.readyState === 4 && insertRecContent) {
                if (request.status == 200) {
                    xhrHandle(request.responseText, insertRecContent);
                }
            }
        };
        request.send(JSON.stringify(params));
    }
</script>
<!--请求推荐列表 结束-->

<!--渲染详情页的JS 渲染详情页的JS 渲染详情页的JS 渲染详情页的JS 渲染详情页的JS 渲染详情页的JS 渲染详情页的JS 结束-->


<!--渲染预览页的JS 渲染预览页的JS 渲染预览页的JS 渲染预览页的JS 渲染预览页的JS 渲染预览页的JS 渲染预览页的JS 开始-->

<!--页面功能JS 开始-->
<!-- <script type="text/javascript">
    window.onload = function () {
        //根据屏幕分辨率请求相应尺寸的图片，目的是减少带宽传输
        var screenWidth = window.screen.width;
        var articlePictures = document.getElementsByClassName('articlePicture');
        if (articlePictures.length !== 0) {
            for (var i = 0; i < articlePictures.length; i++) {
                var articlePictureUrl = articlePictures[i].getAttribute('data-url') + '?x-oss-process=image/resize,w_' + screenWidth;
                articlePictures[i].setAttribute('src', articlePictureUrl);
            }
        }
    };
</script> -->
<!--页面功能JS 结束-->

<!--渲染预览页的JS 渲染预览页的JS 渲染预览页的JS 渲染预览页的JS 渲染预览页的JS 渲染预览页的JS 渲染预览页的JS 结束-->

</body>
</html>
